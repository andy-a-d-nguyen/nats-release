<%
    nats_instances = []
    nats_port = nil
    nats_migrate_port = 4243
    if_link("nats-tls") do |nats_tls_link|
      nats_port = nats_tls_link.p("nats.port")
      nats_tls_link.instances.map do |instance|
        nats_instances.push("#{instance.id}.#{nats_tls_link.p("nats.hostname")}")
      end
    end
    %>
{
    "bootstrap": <%= spec.bootstrap %>,
    "address": <%= "\"#{spec.id}.nats.service.cf.internal\"" %>,
    "nats_instances": [ <%= nats_instances.map { |e| "\"#{e}:#{nats_port}\""}.join(", ")  %> ],
    "nats_port": <%= nats_port %>,
    "nats_migrate_port": <%= nats_migrate_port %>,
    "job": "nats-tls",
    "nats_migrate_servers": [ <%= nats_instances.map { |e| "\"https://#{e}:#{nats_migrate_port}\""}.join(", ")  %> ],
    "nats_internal_tls_enabled": <%= p("nats.internal.tls.enabled") %>,
    "nats_migrate_server_client_cert_file": "/var/vcap/jobs/nats-tls/config/external_tls/certificate.pem",
    "nats_migrate_server_client_key_file": "/var/vcap/jobs/nats-tls/config/external_tls/private_key.pem",
    "nats_migrate_server_ca_file": "/var/vcap/jobs/nats-tls/config/external_tls/ca.pem",
    "nats_bpm_config_path": "/var/vcap/jobs/nats-tls/config/bpm.yml",
    "nats_bpm_v1_config_path": "/var/vcap/jobs/nats-tls/config/bpm.v1.yml",
    "nats_bpm_v2_config_path": "/var/vcap/jobs/nats-tls/config/bpm.v2.yml",
    "monit_path": "/var/vcap/bosh/bin/monit"
}
